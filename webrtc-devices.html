<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body>
  <div>&nbsp;</div>
  <div class="container">
    <div class="log well"></div>
  </div>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="fm/fm.js"></script>
  <script>
    $(function() {
      videoSourceInputs = [];
      mediaVideoDevices = [];
      combinedDevices = [];
      
      var audio = true,
        video = new fm.icelink.VideoConfig(640, 480, 24),
        localMedia = new fm.icelink.LocalMedia(audio, video, false);

        localMedia.getVideoSourceInputs().then(function(videoInputs) {
          videoSourceInputs = videoInputs;
          combinedDevices = videoInputs;

          if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
              navigator.mediaDevices.enumerateDevices().then(function(devices) {
                mediaVideoDevices = devices.filter(function(device) {
                  return device.kind == "videoinput";
                });

                mediaVideoDevices.forEach(function(device) {
                  var deviceIndex = combinedDevices.findIndex(function(source) {
                    return source.getId() == device.deviceId;
                  });

                  if (deviceIndex > -1) {
                    if (combinedDevices[deviceIndex].getId() == combinedDevices[deviceIndex].getName()) {
                      combinedDevices[deviceIndex]._name = device.label;
                    }
                  }
                });

              });
            }

            $(".log").append("<h3>videoSourceInputs</h3>");
            $(".log").append(printObjectArray(videoSourceInputs));
            $(".log").append("<h3>mediaVideoDevices</h3>");
            $(".log").append(printObjectArray(mediaVideoDevices));
            $(".log").append("<h3>combinedDevices</h3>");
            $(".log").append(printObjectArray(combinedDevices));
        });
    });

    function log(msg) {
      $('.log').append('<div>' + msg + '</div>');
    };

    function printObjectArray(objectArray) {
      var result = '';
      objectArray.forEach(function(item) {
        for (key in item) {
          result += "<span>" + key + ":</span> ";
          result += "<span>" + item[key] + "</span> ";
        }
        result += "<hr/>";
      });
    }
  </script>
</body>

</html>
